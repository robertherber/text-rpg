# Ralph Progress Log
# Feature: Text-to-Speech Narration & UI Reorganization
# Branch: ralph/text-to-speech
# Started: 2026-02-15

## Codebase Patterns
- Pre-existing type errors exist in index.ts, App.tsx, gameEngine.ts, imageService.ts - don't need to fix these for new features
- GPT prompts are in src/world/gptService.ts
- Frontend components in src/frontend/ with worldStyles.css for styling
- World system uses /api/world/* endpoints with worldState.locations
- NPC data stored in worldState.npcs with persistence to world-state.json
- BackgroundMusic component already exists in src/frontend/BackgroundMusic.tsx
- StoryPanel parses narrative text to extract NPC dialogue using regex pattern
- TTS service in src/world/ttsService.ts - use generateSpeech(text, voice, instructions?) for audio generation

---

## 2026-02-15 - US-001: Create TTS Service
- Implemented generateSpeech function in src/world/ttsService.ts
- Uses OpenAI's gpt-4o-mini-tts model for high-quality TTS with personality instructions
- Supports all 11 voices: alloy, ash, ballad, coral, echo, fable, onyx, nova, sage, shimmer, verse
- Includes NARRATOR_VOICE (fable) and NARRATOR_INSTRUCTIONS constants for US-009
- NPC_VOICE_POOL excludes fable to reserve it for narrator
- Returns ArrayBuffer (mp3 format) on success, null on failure
- Graceful error handling with logging
- Files changed: src/world/ttsService.ts (created)
- **Learnings for future iterations:**
  - OpenAI audio.speech.create returns a Response object, use .arrayBuffer() to get raw audio
  - Instructions parameter only works with gpt-4o-mini-tts model (not tts-1 or tts-1-hd)
  - API limit is 4096 characters per request
---

