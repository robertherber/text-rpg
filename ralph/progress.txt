# Ralph Progress Log
# Feature: Dialog & Map UI Improvements
# Branch: ralph/dialog-map-improvements
# Started: 2026-02-14

## Codebase Patterns
- Pre-existing type errors exist in index.ts, App.tsx, gameEngine.ts, imageService.ts - don't need to fix these for new features
- GPT prompts are in src/world/gptService.ts
- Frontend components in src/frontend/ with worldStyles.css for styling
- Map rendering uses HTML Canvas in MapPanel.tsx

---

## 2026-02-14 - US-001
- What was implemented: De-emphasized narrator text styling with italic gray (#6b7280) and kept NPC dialog in normal weight with standard text color
- Files changed:
  - src/frontend/StoryPanel.tsx - Added parseNarrativeText function to segment narrator vs dialog, added NarrativeText component
  - src/frontend/worldStyles.css - Added .narrator-text, .dialog-speaker, .dialog-text styles
- **Learnings for future iterations:**
  - Narrative messages contain both narrator descriptions and NPC dialog (quoted text with optional speaker prefix)
  - Dialog pattern uses Name: "text" format or standalone "text" quotes
  - StoryPanel uses a "type" field to distinguish narrative/action/system messages

---

## 2026-02-14 - US-002
- What was implemented: Updated all GPT prompts to use immersive terminology ("adventurer", "traveler", "hero") instead of "player"
- Files changed:
  - src/world/gptService.ts - Updated NARRATOR_PERSONALITY, conversation system prompt, action resolution system prompt, rejection prompt, suggested actions prompt, location generation, world simulation, travel narratives, crafting/building prompts, and character creation prompts
- **Learnings for future iterations:**
  - The NARRATOR_PERSONALITY constant is prepended to all system prompts via `callGPT()`, so adding global instructions there affects all GPT outputs
  - State change type names like `move_player`, `player_damage` are code identifiers and should NOT be changed - only narrative text should use "adventurer"
  - Many prompts had "player" references that needed updating: action resolution, conversation, rejection, suggestions, travel, crafting, building, character creation, world simulation

---

## 2026-02-14 - US-003
- What was implemented: Added explicit instructions to prevent narrator from repeating NPC dialog
- Files changed:
  - src/world/gptService.ts - Added "IMPORTANT DIALOG RULES" section to NARRATOR_PERSONALITY, strengthened action resolution RULES with CRITICAL DIALOG RULE including WRONG/CORRECT examples, updated conversation RULES to emphasize dialog appears only in npcResponse
- **Learnings for future iterations:**
  - The NARRATOR_PERSONALITY constant affects ALL prompts globally, so it's the best place for universal rules
  - Using explicit WRONG/CORRECT examples in prompts helps GPT understand the desired behavior better than just negative instructions
  - The conversation system uses separate fields: npcResponse for dialog, narratorFrame for description - reinforcing this separation in rules prevents redundancy

---

